<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Submission Verification Demo</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    h1 {
      color: #2c3e50;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    
    .card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    
    button {
      background: #c62828;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      display: inline-block;
    }
    
    button:hover {
      background: #b71c1c;
    }
    
    .button-secondary {
      background: #333;
    }
    
    .button-secondary:hover {
      background: #555;
    }
    
    .response {
      background: #f8f9fa;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin-top: 20px;
      border-radius: 4px;
      display: none;
    }
    
    .error {
      border-left-color: #dc3545;
    }
    
    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .hidden {
      display: none;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px solid #ddd;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    
    .tab.active {
      border-bottom-color: #c62828;
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Form Submission Verification Demo</h1>
  
  <div class="info-box">
    <p><strong>This demo showcases form submission monitoring and verification.</strong></p>
    <p>Use the form monitor panel in the bottom-right corner to toggle monitoring on/off and switch between test and live modes.</p>
  </div>
  
  <div class="tabs">
    <div class="tab active" data-tab="demo-form">Demo Form</div>
    <div class="tab" data-tab="documentation">Documentation</div>
  </div>
  
  <div class="tab-content active" id="demo-form">
    <div class="card">
      <h2>Free Training Session Booking</h2>
      <form id="demo-form">
        <div class="form-group">
          <label for="first_name">First Name *</label>
          <input type="text" id="first_name" name="first_name" required>
        </div>
        
        <div class="form-group">
          <label for="last_name">Last Name *</label>
          <input type="text" id="last_name" name="last_name" required>
        </div>
        
        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" required>
        </div>
        
        <div class="form-group">
          <label for="phone">Phone Number *</label>
          <input type="tel" id="phone" name="phone" required>
        </div>
        
        <div class="form-group">
          <label for="appointment_date">Appointment Date *</label>
          <input type="date" id="appointment_date" name="appointment_date" required>
        </div>
        
        <div class="form-group">
          <label for="appointment_time">Appointment Time *</label>
          <select id="appointment_time" name="appointment_time" required>
            <option value="">Select a time</option>
            <option value="09:00">9:00 AM</option>
            <option value="10:00">10:00 AM</option>
            <option value="11:00">11:00 AM</option>
            <option value="13:00">1:00 PM</option>
            <option value="14:00">2:00 PM</option>
            <option value="15:00">3:00 PM</option>
            <option value="16:00">4:00 PM</option>
            <option value="17:00">5:00 PM</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="experience">Experience Level</label>
          <select id="experience" name="experience">
            <option value="beginner">Beginner - No Experience</option>
            <option value="novice">Novice - Some Experience</option>
            <option value="intermediate">Intermediate - Regular Experience</option>
            <option value="advanced">Advanced - Extensive Experience</option>
          </select>
        </div>
        
        <button type="submit">Book Free Training Session</button>
      </form>
      
      <div class="response" id="form-response">
        <h3>Response</h3>
        <pre id="response-data"></pre>
      </div>
    </div>
    
    <div class="card">
      <h3>Test Controls</h3>
      <p>Use these buttons to test different submission scenarios:</p>
      <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="button-secondary" id="fill-valid-data">Fill with Valid Data</button>
        <button class="button-secondary" id="clear-form">Clear Form</button>
        <button class="button-secondary" id="show-verification">Show Verification Results</button>
      </div>
    </div>
  </div>
  
  <div class="tab-content" id="documentation">
    <div class="card">
      <h2>About This Demo</h2>
      <p>This demo page showcases the form verification tools:</p>
      <ul>
        <li><strong>form-submission-monitor.js</strong> - Intercepts and analyzes form submissions</li>
        <li><strong>form-monitor-loader.js</strong> - Provides a user-friendly UI for the monitor</li>
      </ul>
      
      <h3>How To Use</h3>
      <ol>
        <li>Use the panel in the bottom-right corner to toggle monitoring on</li>
        <li>Fill out the form and submit it</li>
        <li>Check the console logs for detailed analysis of the submission</li>
        <li>Toggle "Live Mode" to switch between real submissions and mock responses</li>
      </ol>
      
      <h3>Expected Format</h3>
      <p>The form is designed to match the format used in book-appointment.js with these expected fields:</p>
      <ul>
        <li>first_name</li>
        <li>last_name</li>
        <li>email</li>
        <li>phone</li>
        <li>selected_slot (combination of date and time)</li>
        <li>selected_timezone</li>
        <li>formId</li>
        <li>location_id</li>
        <li>calendar_id</li>
      </ul>
    </div>
  </div>
  
  <!-- Load the form monitor with UI controls -->
  <script src="form-monitor-loader.js"></script>
  
  <script>
    // Form handling
    document.addEventListener('DOMContentLoaded', function() {
      // Tab switching
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // Remove active class from all tabs and content
          tabs.forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
          });
          
          // Add active class to clicked tab and corresponding content
          this.classList.add('active');
          const tabId = this.getAttribute('data-tab');
          document.getElementById(tabId).classList.add('active');
        });
      });
      
      // Form submission
      const form = document.getElementById('demo-form');
      const responseDiv = document.getElementById('form-response');
      const responseData = document.getElementById('response-data');
      
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const formData = new FormData(form);
        const formDataObj = {};
        formData.forEach((value, key) => {
          formDataObj[key] = value;
        });
        
        // Add required fields for proper format
        const appointmentDate = formDataObj.appointment_date;
        const appointmentTime = formDataObj.appointment_time;
        
        // Format as ISO string for selected_slot
        const dateTimeStr = `${appointmentDate}T${appointmentTime}:00`;
        const date = new Date(dateTimeStr);
        const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        
        // Add the required fields
        const finalFormData = {
          ...formDataObj,
          selected_slot: dateTimeStr,
          selected_timezone: timeZone,
          formId: "bHbGRJjmTWG67GNRFqQY",
          location_id: "wCjIiRV3L99XP2J5wYdA",
          calendar_id: "EwO4iAyVRl5dqwH9pi1O"
        };
        
        // Create multipart form body
        const boundary = '----geckoformboundary' + Math.random().toString(16).substring(2);
        let body = '';
        
        // Add formData part
        body += `--${boundary}\r\n`;
        body += 'Content-Disposition: form-data; name="formData"\r\n\r\n';
        body += JSON.stringify(finalFormData) + '\r\n';
        
        // Add locationId part
        body += `--${boundary}\r\n`;
        body += 'Content-Disposition: form-data; name="locationId"\r\n\r\n';
        body += finalFormData.location_id + '\r\n';
        
        // Add formId part
        body += `--${boundary}\r\n`;
        body += 'Content-Disposition: form-data; name="formId"\r\n\r\n';
        body += finalFormData.formId + '\r\n';
        
        // Add captchaV3 part
        body += `--${boundary}\r\n`;
        body += 'Content-Disposition: form-data; name="captchaV3"\r\n\r\n';
        body += 'CAPTCHA_TOKEN_PLACEHOLDER\r\n';
        
        // Close the body
        body += `--${boundary}--\r\n`;
        
        // Send data to backend (will be intercepted by the monitor)
        fetch('https://backend.leadconnectorhq.com/appengine/appointment', {
          method: 'POST',
          headers: {
            'Content-Type': `multipart/form-data; boundary=${boundary}`,
            'User-Agent': 'Mozilla/5.0 (Test Browser)',
            'Accept': '*/*',
            'Referer': window.location.href,
            'Origin': window.location.origin
          },
          body: body
        })
        .then(response => response.json())
        .then(data => {
          // Show response
          responseDiv.style.display = 'block';
          responseDiv.classList.remove('error');
          responseData.textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
          // Show error
          responseDiv.style.display = 'block';
          responseDiv.classList.add('error');
          responseData.textContent = 'Error: ' + error.message;
        });
      });
      
      // Test controls
      document.getElementById('fill-valid-data').addEventListener('click', function() {
        document.getElementById('first_name').value = 'Test';
        document.getElementById('last_name').value = 'User';
        document.getElementById('email').value = 'test@example.com';
        document.getElementById('phone').value = '+12345678901';
        
        // Set date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowStr = tomorrow.toISOString().split('T')[0];
        document.getElementById('appointment_date').value = tomorrowStr;
        
        document.getElementById('appointment_time').value = '10:00';
        document.getElementById('experience').value = 'beginner';
      });
      
      document.getElementById('clear-form').addEventListener('click', function() {
        form.reset();
        responseDiv.style.display = 'none';
      });
      
      document.getElementById('show-verification').addEventListener('click', function() {
        // Get form data
        const formData = new FormData(form);
        const formDataObj = {};
        formData.forEach((value, key) => {
          formDataObj[key] = value;
        });
        
        // Add required fields
        const appointmentDate = formDataObj.appointment_date;
        const appointmentTime = formDataObj.appointment_time;
        
        // Format as ISO string for selected_slot
        const dateTimeStr = appointmentDate && appointmentTime ? 
          `${appointmentDate}T${appointmentTime}:00` : '';
        
        const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        
        const finalFormData = {
          ...formDataObj,
          selected_slot: dateTimeStr,
          selected_timezone: timeZone,
          formId: "bHbGRJjmTWG67GNRFqQY",
          location_id: "wCjIiRV3L99XP2J5wYdA",
          calendar_id: "EwO4iAyVRl5dqwH9pi1O"
        };
        
        // Check required fields
        const requiredFields = [
          'first_name', 'last_name', 'email', 'phone', 
          'selected_slot', 'selected_timezone',
          'formId', 'location_id', 'calendar_id'
        ];
        
        const missingFields = requiredFields.filter(field => 
          !finalFormData[field] || finalFormData[field] === ''
        );
        
        // Show verification results
        responseDiv.style.display = 'block';
        if (missingFields.length > 0) {
          responseDiv.classList.add('error');
          responseData.textContent = 'Missing required fields: ' + missingFields.join(', ');
        } else {
          responseDiv.classList.remove('error');
          responseData.textContent = 'Form data verification passed!\n\n' + 
            JSON.stringify(finalFormData, null, 2);
        }
      });
    });
  </script>
</body>
</html> 